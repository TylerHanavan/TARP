<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE-edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" type="text/css" href="courseStyle.css">
<title>Course Page</title>

<script>
	var editModal = document.getElementById('addTaModal');
	var modalBtn = document.getElementById('modalLink');

	function loadCourse() {
	  var course = window.location.href.split("=")[1];
	  var xhttp = new XMLHttpRequest();
	  xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
			  var courses = JSON.parse(this.responseText);
				for(var x = 0; x < courses.length; x++) {
					if(courses[x].id == course) {
						$("#course").text(courses[x].name);
						$("#course").show();
						return;
					}
				}
			}
	  };
	  xhttp.open("GET", "/CSE442-542/2018-Summer/team03/backend/get/courses.php?course="+course, true);
	  xhttp.send();
	}

	function loadTAs() {
	  var course = window.location.href.split("=")[1];
	  var xhttp = new XMLHttpRequest();
	  xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
			  var tas = JSON.parse(this.responseText);
			  var taElement = document.getElementById("viewTas");
			  for(var i = 0; i < tas.length; i++) {
					var child = document.createElement('p');
					child.value = tas[i].id;
					child.innerHTML = tas[i].name;
					console.log(tas[i].name);
					taElement.appendChild(child);
			  }
			}
	  };
	  xhttp.open("GET", "/CSE442-542/2018-Summer/team03/backend/get/tas.php?course="+course, true);
	  xhttp.send();
	}

	function loadFeedback() {
		var course = window.location.href.split("=")[1];
	  var xhttp = new XMLHttpRequest();
	  xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
			  var feedback = JSON.parse(this.responseText);
			  var feedbackElement = document.getElementById("feedbackContainer");
			  for(var i = 0; i < feedback.length; i++) {

					var div = document.createElement('div');
					feedbackElement.appendChild(div);
					var child = document.createElement('p');
					div.append(child);
					child.value = feedback[i].id;
					console.log(feedback[i].name);
					feedbackElement.appendChild(child);
					var exp = feedback[i].experience;
					if(exp == 1) exp = 'Very Bad';
					if(exp == 2) exp = 'Bad';
					if(exp == 3) exp = 'Good';
					if(exp == 4) exp = 'Very Good';
					child.innerHTML = 'TA: ' + feedback[i].taName[0] + '<br />Comments: ' + feedback[i].comments + "<br />Experience: " + exp + "<br />Contact Info: " + feedback[i].email + "<br /><hr />";
			  }
			}
	  };
	  xhttp.open("GET", "/CSE442-542/2018-Summer/team03/backend/get/feedback.php?course="+course, true);
	  xhttp.send();
	}

	function init() {

		$(jQuery).ready(function() {
			
			$('#courseID').val(window.location.href.split("=")[1]);
			$('.modal').hide();

			loadTAs();

			loadFeedback();

			loadCourse();

			$('.closeBtn').click(function() {

				$(this).parent().parent().hide();

			});
			
			$('#viewTaModalButton').click(function() {

				$('#viewTaModal').show();

			});
			
			$('#delTaModalButton').click(function() {

				$('#delTaModal').show();

			});

		});

	}

</script>

</head>

<body onload="init()">
	<div class="container">
		<h1 id="course" style="display: none;">Course Name Here</h1><hr/>
		
		<button type="submit" class="btn-success btn-lg button open-modal" id="viewTaModalButton">View TAs</button>
		<button class="btn-danger btn-lg button open-modal" type="submit" id="delTaModalButton">Delete Course</button>
		<!--<button style='float: right;'type="submit" class="buttonStyle" class="button">Add TAs</button>-->

		<div id="viewTaModal" class="modal" style="display: none;">
				<div class="modal-content" id="viewTas">
					<span class="closeBtn">&times;</span>
				</div>
		</div>

		<div id="delTaModal" class="modal" style="display: none;">
				<div class="modal-content" id="deleteCourse">
					<span class="closeBtn">&times;</span>
					<p align="center">Are You sure you want to delete this course?</p>
					
					<form action="../backend/submit/remove-course.php" method="POST">
					<center><button type="submit" class="btn-success btn-lg">Yes</button>
					<input id="courseID" name="course" style="display: none"></input>
					</form>
					
					<button type="submit" class="btn-danger btn-lg">No</button></center>
					
				</div>
		</div>
		<div id="feedbackContainer" class="feedbackContainer">
			
		</div>
	</div>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>

</body>

</html>
